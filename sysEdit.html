<!DOCTYPE html>
<head>
	<link rel="stylesheet" type="text/css" href="basic.css">
	<title>Sr. Especialista</title>
</head>



<body>
	<div class="card">
		<h3>Perfil: <span id="txtUsuario">--</span></h3>
		<h3>Especialidade: <span id="txtSistema">--</span></h3>
		<br>
		<button id="btFinalizar">Finalizar edição</button>
	</div>
	
	<div class="card">
		<h3>Descrição</h3>
		<textarea id="inpDescricao" size=2 class="input100"></textarea>
		<button id="btSalvarDesc">Salvar descrição</button>
	</div>

	<div class="card">
		<h3>Perguntas</h3>
		<select id="slcPergunta" size=5 class="input73L"></select>
		<select id="slcValores" size=5 class="input73R"></select>
		<div>
			<input id="inpPergunta" class="input73L"/>
			<input id="inpValor" class="input73R"/>
		</div>
		<button id="btSalvarPergunta">&#10004;</button>
		<button id="btApagarPergunta">&#10008;</button>
	</div>

	<div class="card">
			<h3>Resultados</h3>
			<select id="slcResultado" class="input100" size=5></select>
			<input id="inpResultado" class="input100"/>
			<button id="btSalvarResultado">&#10004;</button>
			<button id="btApagarResultado">&#10008;</button>
	</div>

	<div class="card">
		<h3>Condições</h3>
		<select id="slcRegras" size=5 style="width:100%;"></select>
		<button>Adicionar Regra</button>
		<button>Excluir Regra</button>
	</div>
</body>



<script>
// ---------- Imports
const { remote } = require('electron')
const dal = remote.require('./data-access-layer.js')
const controllerSelectEdit = require('./controllerSelectEdit.js')
const thisWin = remote.getCurrentWindow()


// ---------- Elementos do DOM
const txtUsuario = document.getElementById("txtUsuario")
const txtSistema = document.getElementById("txtSistema")
const btFinalizar = document.getElementById('btFinalizar')

const inpDescricao = document.getElementById("inpDescricao")
const btSalvarDesc = document.getElementById("btSalvarDesc")


const slcValores = document.getElementById("slcValores")
const slcConclusoes = document.getElementById("slcConclusoes")
const slcRegras = document.getElementById("slcRegras")


// ---------- INICIALIZAÇOES
usuarioNome = dal.getPerfilAtivo().nome
sistemaNome = dal.getSistemaAtivo().nome
sistemaId = dal.getSistemaAtivo().id
sistemDesc = dal.getSistemaAtivo().descricao

txtUsuario.innerHTML = dal.getPerfilAtivo().nome
txtSistema.innerHTML = dal.getSistemaAtivo().nome
inpDescricao.innerHTML = dal.getSistemaAtivo().descricao


// ---------- Events
btFinalizar.addEventListener('click',clickBtFinalizar)

// ---------- Inicialização do componente Perguntas
let ctrlPerguntas = new controllerSelectEdit()
dal.fetchAllFatos().then(perguntas => {
	ctrlPerguntas.model.dataArray = perguntas
	ctrlPerguntas.model.textColumn = "fato"
	ctrlPerguntas.model.valueColumn = "id"
	ctrlPerguntas.model.pkColumn = 'id'
	
	ctrlPerguntas.view.selectBox = document.getElementById("slcPergunta"),
	ctrlPerguntas.view.inputField = document.getElementById('inpPergunta'),
	ctrlPerguntas.view.buttonSave = document.getElementById('btSalvarPergunta'),
	ctrlPerguntas.view.buttonDel = document.getElementById('btApagarPergunta')

	ctrlPerguntas.logic.dataObjSaveFunc = dal.saveDataObj
	ctrlPerguntas.logic.dataObjDelFunc = dal.delDataObj
	ctrlPerguntas.logic.dataObjFactory = function() { return {sistema_fk:dal.getSistemaAtivo().id, fato:null} }
	ctrlPerguntas.logic.dbTableName = "fatos"

	ctrlPerguntas.render()
})

// ---------- Inicialização do componente Resultados
let ctrlResultados = new controllerSelectEdit()
dal.fetchAllFatos().then(resultados => {
	ctrlResultados.model.dataArray = resultados
	ctrlResultados.model.textColumn = "fato"
	ctrlResultados.model.valueColumn = null
	
	ctrlResultados.view.selectBox = document.getElementById("slcResultado"),
	ctrlResultados.view.inputField = document.getElementById('inpResultado'),
	ctrlResultados.view.buttonSave = document.getElementById('btSalvarResultado'),
	ctrlResultados.view.buttonDel = document.getElementById('btApagarResultado')

	ctrlResultados.logic.saveFunction = null
	ctrlResultados.logic.delFunction = null

	ctrlResultados.render()
})

// ---------
function clickBtFinalizar(){
	thisWin.loadFile('./sysMain.html')
}
</script>
</html>