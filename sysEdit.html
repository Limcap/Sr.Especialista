<!DOCTYPE html>
<head>
	<link rel="stylesheet" type="text/css" href="basic.css">
	<title>Sr. Especialista</title>
</head>



<body>
	<div class="spaced-area">
		<h3>Perfil: <span id="txtUsuario">Usuario</span></h3>
		<h3>Especialidade: <span id="txtSistema">Sistema</span></h3>
		<button id="btFinalizar" class="btFinalizar">Finalizar edição</button>
	</div>
	<hr>
	<div class="spaced-area edit">
		<h3>Descrição</h3>
		<textarea id="inpDescricao" size=2 style="width:99%; resize:none; overflow-y: scroll"></textarea>
		<button id="btSalvarDesc">Salvar descrição</button>
	</div>
	<hr>
	<div class="spaced-area">
		<h3>Perguntas</h3>
		<select id="slcFatos" size=5 class="input73L"></select>
		<select id="slcValores" size=5 class="input73R"></select>
		
		<div>
			<input id="inpFato" class="input73L"/>
			<input id="inpValor" class="input73R"/>
		</div>
		<button id="btSalvarFato">Salvar fato</button>
		<button id="btExcluirFato">Excluir fato</button>
	</div>
	<hr>
	<div class="spaced-area">
		<h3>Resultados</h3>
		<select id="slcRegras" size=5 style="width:100%;"></select>
		<button>Adicionar Regra</button>
		<button>Excluir Regra</button>
	</div>
	<hr>
	<div class="spaced-area">
		<h3>Condições</h3>
		<select id="slcRegras" size=5 style="width:100%;"></select>
		<button>Adicionar Regra</button>
		<button>Excluir Regra</button>
	</div>
</body>




<script>
// ---------- Imports
const { remote } = require('electron')
const dal = remote.require('./data-access-layer.js')
const thisWin = remote.getCurrentWindow()


// ---------- Elementos do DOM
const txtUsuario = document.getElementById("txtUsuario")
const txtSistema = document.getElementById("txtSistema")
const btFinalizar = document.getElementById('btFinalizar')
const inpDescricao = document.getElementById("inpDescricao")
const btSalvarDesc = document.getElementById("btSalvarDesc")
const slcFatos = document.getElementById("slcFatos")
const inpFato = document.getElementById('inpFato')
const btSalvarFato = document.getElementById('btSalvarFato')
const slcValores = document.getElementById("slcValores")
const slcConclusoes = document.getElementById("slcConclusoes")
const slcRegras = document.getElementById("slcRegras")


// ---------- Init
txtUsuario.innerHTML = dal.getPerfilAtivo().nome
txtSistema.innerHTML = dal.getSistemaAtivo().nome
inpDescricao.innerHTML = dal.getSistemaAtivo().descricao
preencherFatos()


// ---------- Events
btFinalizar.addEventListener('click',clickBtFinalizar)
btSalvarFato.addEventListener('click',clickBtSalvarFato)


// ---------- Funções de init
function preencherFatos() {
	dal.fetchAllFatos()
	.then(rows => {
		let i = 0
		rows.forEach(row => {
			let opt = newOption(row.fato, i, row, "clickOptFatos(this)")
			slcFatos.options.add(opt)
			i++
		});
		slcFatos.options.add( newOption("+ Novo Fato","-1",null,"clickOptFatos(this)"))
	})
}

function newOption(text,value,obj,onclick) {
	opt = document.createElement("option")
	opt.text = text
	opt.value = value
	opt.obj = obj
	opt.setAttribute("onclick",onclick)
	return opt
}

// ---------- Funções de Eventos
function clickBtFinalizar(){
	thisWin.loadFile('./sysMain.html')
}

function clickOptFatos(opt) {
	inpFato.value = opt.obj ? opt.text : ""
	inpFato.opt = opt
	inpFato.focus()
}

function clickBtSalvarFato() {
	if(inpFato.opt.obj) {
		inpFato.opt.text = inpFato.value
	} else {
		let opt = newOption(inpFato.value,"",{},"clickOptFatos(this)")
		slcFatos.options.add( opt )
		inpFato.opt = opt
	}
}



</script>
</html>