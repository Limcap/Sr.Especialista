<!DOCTYPE html>
<head>
	<link rel="stylesheet" type="text/css" href="basic.css">
	<title>Sr. Especialista</title>
</head>



<body>
	<div class="card">
		<h3>Perfil: <span id="txtUsuario">--</span></h3>
		<h3>Especialidade: <span id="txtSistema">--</span></h3>
		<br>
		<button id="btFinalizar">Finalizar edição</button>
	</div>
	
	<div class="card grow">
		<h3>Descrição</h3>
		<textarea id="inpDescricao" size=2 class="grow-1"></textarea>
		<div><button id="btSalvarDesc">Salvar descrição</button></div>
	</div>

	<div class="card grow">
		<section class='section-73'>
			<h3>Perguntas</h3>
			<h3>Respostas</h3>
		</section>
		<section class='section-73 grow-1'>
			<select id='slcPergunta' size=5></select>
			<select id='slcResposta' size=5></select>
		</section>
		<section class='section-73'>
			<input id='inpPergunta' />
			<input id='inpResposta' />
		</section>
		<section class='section-73'>
			<div>
				<button id="btSalvarPergunta">&#10004;</button>
				<button id="btApagarPergunta">&#10008;</button>
			</div>
			<div>
				<button id="btSalvarResposta">&#10004;</button>
				<button id="btApagarResposta">&#10008;</button>
			</div>
		</section>
	</div>

	<div class="card grow">
			<section class='section-73'>
				<h3>Objetivos</h3>
				<h3>Conclusões</h3>
			</section>
			<section class='section-73 grow-1'>
				<select id='slcObjetivo' size=5></select>
				<select id='slcConclusao' size=5></select>
			</section>
			<section class='section-73'>
				<input id='inpObjetivo' />
				<input id='inpConclusao' />
			</section>
			<section class='section-73'>
				<div>
					<button id="btSalvarObjetivo">&#10004;</button>
					<button id="btApagarObjetivo">&#10008;</button>
				</div>
				<div>
					<button id="btSalvarConclusao">&#10004;</button>
					<button id="btApagarConclusao">&#10008;</button>
				</div>
			</section>
		</div>

	<div class="card grow">
			<h3>Resultados</h3>
			<select id="slcResultado" class="grow-1" size=5></select>
			<input id="inpResultado"/>
			<div>
				<button id="btSalvarResultado">&#10004;</button>
				<button id="btApagarResultado">&#10008;</button>
			</div>
	</div>

	<div class="card grow">
		<h3>Condições</h3>
		<select id="slcRegras" size=5 class="grow-1"></select>
		<div>
			<button>Adicionar Regra</button>
			<button>Excluir Regra</button>
		</div>
	</div>
</body>



<script>
// ---------- Imports
const menu = require('./menu.js')
const { remote } = require('electron')
const dal = remote.require('./data-access-layer.js')
const controllerSelectEdit = require('./controllerSelectEdit.js')
const thisWin = remote.getCurrentWindow()


// ---------- Elementos do DOM
const txtUsuario = document.getElementById("txtUsuario")
const txtSistema = document.getElementById("txtSistema")
const btFinalizar = document.getElementById('btFinalizar')

const inpDescricao = document.getElementById("inpDescricao")
const btSalvarDesc = document.getElementById("btSalvarDesc")


// ---------- INICIALIZAÇOES
usuarioNome = dal.getPerfilAtivo().nome
sistemaNome = dal.getSistemaAtivo().nome
sistemaId = dal.getSistemaAtivo().id
sistemDesc = dal.getSistemaAtivo().descricao

txtUsuario.innerHTML = dal.getPerfilAtivo().nome
txtSistema.innerHTML = dal.getSistemaAtivo().nome
inpDescricao.innerHTML = dal.getSistemaAtivo().descricao

// ---------- Events
btFinalizar.addEventListener('click',clickBtFinalizar)


// ---------- COMPONENTE PERGUNTAS
let ctrlPerguntas = new controllerSelectEdit()
ctrlPerguntas.setView( 'slcPergunta','inpPergunta','btSalvarPergunta','btApagarPergunta' )
ctrlPerguntas.setRefs( 'pergunta','id','sistema_fk',sistemaId )
ctrlPerguntas.data.fetch = () => dal.fetchAll('perguntas')
ctrlPerguntas.logic.onSave = (dob,pkName) => dal.saveDataObj(dob,'perguntas',pkName)
ctrlPerguntas.logic.onDelete = (dob,pkName) => dal.delDataObj(dob,'perguntas',pkName)
ctrlPerguntas.boot()

/*
// muda a lista de respostas de acordo com a pergunta selecionada
ctrlPerguntas.logic.onSelect = function() {
	let respostaArr = null
	let perguntaDob = ctrlPerguntas.getSelectedDob()
	if( perguntaDob ) {
		respostaArr = []
		if( perguntaDob.id ) {
			respostasAll.forEach(respostaDob => {
				if( respostaDob.pergunta_fk == perguntaDob.id ) {
					respostaArr.push( respostaDob )
				}
			})
		}
	}
	ctrlRespostas.model.dataArray = respostaArr
	ctrlRespostas.render()
}
ctrlPerguntas.logic.dataObjSaveFunc = async function ( dobPergunta, tableName, pkName ) {
	dobPergunta.sistema_fk = dal.getSistemaAtivo().id
	return await dal.saveDataObj( dobPergunta, tableName, pkName )
}
ctrlPerguntas.logic.dataObjDelFunc = dal.delDataObj

dal.fetchAll("perguntas").then(rows => {
	ctrlPerguntas.model.dataArray = rows
	ctrlPerguntas.render()
})
*/

// ---------- COMPONENTE RESPOSTAS
let ctrlRespostas = new controllerSelectEdit()
ctrlRespostas.setView( 'slcResposta','inpResposta','btSalvarResposta','btApagarResposta' )
ctrlRespostas.setRefs( 'resposta','id','pergunta_fk' )
ctrlRespostas.data.fetch = () => dal.fetchAll("respostas")
ctrlRespostas.logic.onSave = (dob,pkName) => dal.saveDataObj(dob,'respostas',pkName)
ctrlRespostas.logic.onDelete = (dob,pkName) => dal.delDataObj(dob,'respostas',pkName)
ctrlRespostas.boot()
ctrlPerguntas.updateChild( ctrlRespostas )

/*
ctrlRespostas.logic.dataObjDelFunc = dal.delDataObj
ctrlRespostas.logic.dataObjSaveFunc = async function( respostaDob, tableName, pkName  ) {
	let perguntaDob = ctrlPerguntas.getSelectedDob()
	if( !perguntaDob || !perguntaDob.id ) {
		alert( "Selecione uma pergunta primeiro ")
		return false
	} else {
		//respostaDob.sistema_fk = dal.getSistemaAtivo().id
		respostaDob.pergunta_fk = perguntaDob.id
		return await dal.saveDataObj( respostaDob, tableName, pkName )
	}
}
*/

// ---------- COMPONENTE OBJETIVOS
let ctrlObjetivos = new controllerSelectEdit()
ctrlObjetivos.setView( 'slcObjetivo','inpObjetivo','btSalvarObjetivo','btApagarObjetivo' )
ctrlObjetivos.setRefs( 'objetivo','id','sistema_fk',sistemaId )
ctrlObjetivos.data.fetch = () => dal.fetchAll('objetivos')
ctrlObjetivos.logic.onSave = (dob,pkName) => dal.saveDataObj(dob,'objetivos',pkName)
ctrlObjetivos.logic.onDelete = (dob,pkName) => dal.delDataObj(dob,'objetivos',pkName)
ctrlObjetivos.boot()

// ---------- COMPONENTE CONCLUSOES
let ctrlConclusoes = new controllerSelectEdit()
ctrlConclusoes.setView( 'slcConclusao','inpConclusao','btSalvarConclusao','btApagarConclusao' )
ctrlConclusoes.setRefs( 'conclusao','id','objetivo_fk' )
ctrlConclusoes.data.fetch = () => dal.fetchAll('conclusoes')
ctrlConclusoes.logic.onSave = (dob,pkName) => dal.saveDataObj(dob,'conclusoes',pkName)
ctrlConclusoes.logic.onDelete = (dob,pkName) => dal.delDataObj(dob,'conclusoes',pkName)
ctrlConclusoes.boot()

ctrlObjetivos.updateChild( ctrlConclusoes )

// ---------
function clickBtFinalizar(){
	thisWin.loadFile('./sysMain.html')
}
</script>
</html>